---
import Base from './Base.astro';
import AuthorWidget from "../components/AuthorWidget.astro";
import ArticleTOC from "../components/ArticleTOC.astro";
import TagCloud from "../components/TagCloud.astro";
import Comment from "../components/Comment.astro";
import ArticleInfo from '../components/ArticleInfo.astro';
import { themeConfig } from '../../starread.config';

// 从props接收必要的数据
const { entry, wordCount, formatDate } = Astro.props;
---

<Base title={Astro.props.title}>
  <Fragment slot="head">
    <!--  canonical链接，优先使用永久链接，否则使用slug -->
    <link rel="canonical" href={entry?.data?.permalink || (Astro.url.pathname)} />
  </Fragment>
  
  <Fragment slot="header">
    <ArticleInfo 
      title={entry?.data?.title || Astro.props.title}
      cover={entry?.data?.cover || Astro.props.cover || themeConfig.site.defaultCover}
      date={formatDate?.(entry?.data?.date) || Astro.props.date}
      tags={entry?.data?.tags || Astro.props.tags || []}
      categories={entry?.data?.categories || Astro.props.categories || []}
      wordCount={wordCount || Astro.props.wordCount || 0}
      permalink={entry?.data?.permalink || Astro.props.permalink}
    />
  </Fragment>
  
  <!-- 左侧内容 -->
  <slot />
  <Comment/>
  
  <!-- 右侧边栏 -->
  <Fragment slot="sidebar">
    {themeConfig.sidebar.article.authorWidget && <AuthorWidget />}
    {themeConfig.sidebar.article.tag && <TagCloud />}
    {themeConfig.sidebar.article.toc && <ArticleTOC />}
  </Fragment>
</Base>
