---
import "../styles/global.css";
import NavBar from "../components/NavBar.astro";
import AuthorWidget from "../components/AuthorWidget.astro";
import AdWidget from "../components/AdWidget.astro";
import TagCloud from "../components/TagCloud.astro";
import { themeConfig } from '../../starread.config';
import { ClientRouter } from "astro:transitions";


interface Props {
  title: string;
  categoryName?: string;
  currentCategory?: string;
  articles: any[];
  allCategories: Record<string, number>;
}

const { title, categoryName, currentCategory, articles, allCategories } = Astro.props;
---

<html lang="zh-CN" class="min-h-full antialiased">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/png" href={themeConfig.site.favicon} />
    <meta name="generator" content={Astro.generator} />
    <title>{ title || themeConfig.site.title }</title>
    <ClientRouter />
  </head>
  <body class="min-h-screen bg-slate-100 text-gray-900 dark:bg-gray-950 dark:text-neutral-100 transition-colors">
    <NavBar title={title} />
    <main class="container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6">
      <!-- 左侧内容区域 -->
      <div class="w-full md:w-2/3 space-y-6">
        <div class="bg-white/70 backdrop-blur-xl border border-white/20 shadow-[0_1px_0_0_rgba(255,255,255,0.6)_inset,0_8px_30px_rgba(0,0,0,0.06)] dark:bg-cyan-950/30 dark:backdrop-blur-xl dark:border-white/10 dark:shadow-[0_1px_0_0_rgba(255,255,255,0.08)_inset,0_8px_30px_rgba(0,0,0,0.35)] rounded-lg shadow-sm p-6">
          <h1 class="text-2xl font-bold mb-6">{categoryName || "所有分类"}</h1>

          <!-- 分类筛选标签 -->
          {allCategories && (
            <div class="flex flex-wrap gap-3 mb-8">
              {Object.entries(allCategories).map(([category, count]) => (
                <a 
                  key={category} 
                  href={`/category/${encodeURIComponent(category)}`} 
                  class={`px-3 py-1 rounded-full text-sm transition-colors hover:opacity-90 ${ 
                    category === currentCategory 
                      ? 'bg-primary dark:bg-secondary text-white' 
                      : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200' 
                  }`}
                >
                  {category} ({count})
                </a>
              ))}
            </div>
          )}

          <!-- 文章列表 -->
          <div class="space-y-4">
            {articles.length > 0 ? (
              articles.map((article, index) => (
                <div key={article.slug} class="flex items-center p-4 border border-gray-100 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-white/5 transition-colors">
                  {/* 封面图 */}
                  <div class="w-20 h-20 rounded-md overflow-hidden mr-4 flex-shrink-0">
                    <img 
                      src={article.data.cover || '/defaultCover.jpg'} 
                      alt={article.data.title} 
                      class="w-full h-full object-cover"
                    />
                  </div>
                  {/* 文章信息 */}
                  <div class="flex-grow min-w-0">
                    <a href={`/${article.collection === 'articles' ? 'articles' : 'notes'}/${article.slug}`} class="text-lg font-medium hover:text-primary transition-colors line-clamp-1">{article.data.title}</a>
                    <div class="flex items-center mt-1 text-sm text-gray-500 space-x-3">
                      <span>{article.data.author || themeConfig.widget.author.name}</span>
                      <span>·</span>
                      <span>{typeof article.data.date === 'string' ? article.data.date.split(' ')[0] : article.data.date?.toISOString().split('T')[0]}</span>
                    </div>
                  </div>
                  {/* 序号 */}
                  <div class="ml-4 w-8 h-8 bg-primary dark:bg-secondary text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
                    {index + 1}
                  </div>
                </div>
              ))
            ) : (
              <div class="text-center py-8 text-gray-500">
                暂无该分类下的内容
              </div>
            )}
          </div>
        </div>
      </div>

      <!-- 右侧边栏 -->
      <aside class="w-full md:w-1/3 space-y-6">
        {themeConfig.sidebar.home.authorWidget && <AuthorWidget />}
        {themeConfig.sidebar.home.adWidget && <AdWidget />}
        {themeConfig.sidebar.home.tag && <TagCloud />}
      </aside>
    </main>

    <footer class="bg-white/70 dark:bg-cyan-950/30 bg-white/5 dark:backdrop-blur-xl dark:border dark:border-cyan-600/20 shadow-inner mt-10 py-6">
      <div class="container mx-auto px-4 text-center text-gray-600 text-sm">
        <p>{themeConfig.site.footer.text}</p>
      </div>
    </footer>
  </body>
</html>